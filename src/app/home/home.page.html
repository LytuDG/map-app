<ion-header class="ion-no-border custom-header">
  <ion-toolbar color="white">
    <div class="logo-container">
      <div class="map-social-logo">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Abstract Friendly Logo: Connecting Nodes/Smile -->
          <circle cx="16" cy="16" r="14" fill="url(#paint0_linear)" fill-opacity="0.1" />
          <path d="M10 16C10 16 12 21 16 21C20 21 22 16 22 16" stroke="url(#paint1_linear)" stroke-width="3"
            stroke-linecap="round" />
          <circle cx="10" cy="14" r="2.5" fill="#F09433" />
          <circle cx="22" cy="14" r="2.5" fill="#BC1888" />
          <defs>
            <linearGradient id="paint0_linear" x1="2" y1="2" x2="30" y2="30" gradientUnits="userSpaceOnUse">
              <stop stop-color="#F09433" />
              <stop offset="1" stop-color="#BC1888" />
            </linearGradient>
            <linearGradient id="paint1_linear" x1="10" y1="16" x2="22" y2="21" gradientUnits="userSpaceOnUse">
              <stop stop-color="#F09433" />
              <stop offset="1" stop-color="#BC1888" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      <ion-title class="app-logo-text">Spotl</ion-title>
    </div>

    <ion-buttons slot="end">
      <ion-button class="icon-btn" (click)="openNotifications()">
        <ion-icon name="notifications-outline"></ion-icon>
        <div class="badge-dot"></div>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding-bottom">

  <div class="content-wrapper">
    <!-- Stories / Status -->
    <div class="stories-section ion-padding-start ion-margin-bottom">
      <div class="story-item" *ngFor="let s of stories">
        <div class="story-ring" [class.active]="s.active" [class.user]="s.isUser">
          <ion-avatar>
            <img [src]="s.img" class="img-load" />
          </ion-avatar>
          <div class="add-icon" *ngIf="s.isUser">+</div>
        </div>
        <ion-text class="story-name">{{ s.name }}</ion-text>
      </div>
    </div>

    <!-- Unified Feed -->
    <div class="feed-list ion-padding-horizontal">

      <!-- Normalized Cards -->
      <div *ngFor="let item of feedItems" class="feed-card">

        <!-- 1. Header (Consistent) -->
        <div class="card-header">
          <div class="user-info">
            <ion-avatar>
              <img [src]="item.userImg" class="img-load" />
            </ion-avatar>
            <div class="user-text">
              <span class="main-text">{{ item.type === 'post' ? item.user : item.name }}</span>
              <span class="sub-text">{{ item.type === 'post' ? item.location : item.category }}</span>
            </div>
          </div>
        </div>

        <!-- 2. Media (Consistent) -->
        <div class="card-media img-load">
          <img [src]="item.img" loading="lazy" />

          <!-- Overlays -->
          <div class="overlay-badge date-badge" *ngIf="item.type === 'event'">
            {{ item.date }}
          </div>
          <div class="overlay-badge deal-badge" *ngIf="item.type === 'deal'" [style.background]="item.color">
            {{ item.offer }}
          </div>

          <!-- Action Button for Business/Events (e.g. Join) overlaid or bottom -->
          <div class="overlay-action" *ngIf="item.type === 'event' || item.type === 'deal'">
            <!-- Optional: put specific action here if design requires -->
          </div>
        </div>

        <!-- 3. Actions (NOW CONSISTENT FOR ALL) -->
        <div class="card-actions-wrapper">

          <!-- Primary Social Actions Row (Like, Comment, Share) -->
          <div class="social-row">
            <div class="left-actions">
              <ion-button fill="clear" class="action-icon-btn" (click)="toggleLike(item)">
                <ion-icon [name]="item.liked ? 'heart' : 'heart-outline'" [class.liked]="item.liked"></ion-icon>
              </ion-button>
              <ion-button fill="clear" class="action-icon-btn" (click)="handleAction('comment')">
                <ion-icon name="chatbubble-outline"></ion-icon>
              </ion-button>
              <ion-button fill="clear" class="action-icon-btn" (click)="handleAction('share')">
                <ion-icon name="paper-plane-outline"></ion-icon>
              </ion-button>
            </div>

            <!-- Specific CTA button if Business/Event -->
            <div class="right-actions" *ngIf="item.type !== 'post'">
              <ion-button shape="round" size="small" [fill]="item.going ? 'solid' : 'outline'"
                [color]="item.going ? 'success' : 'dark'" class="main-cta"
                (click)="item.type === 'event' ? toggleJoin(item) : handleAction('click_cta')">
                {{ item.actionLabel || 'Ver Más' }}
              </ion-button>
            </div>

            <!-- Bookmark for Posts -->
            <div class="right-actions" *ngIf="item.type === 'post'">
              <ion-button fill="clear" class="action-icon-btn">
                <ion-icon name="bookmark-outline"></ion-icon>
              </ion-button>
            </div>
          </div>

          <!-- Likes Count -->
          <div class="context-row">
            <span class="likes-count" *ngIf="item.likes">{{ item.likes }} Me gusta</span>

            <!-- Extra Context for Events/Biz -->
            <span class="meta-context" *ngIf="item.type === 'event' && !item.likes">
              <ion-icon name="people-outline"></ion-icon> {{ item.attendees }} asisten
            </span>
            <span class="meta-context" *ngIf="item.type === 'business' && item.rating && !item.likes">
              ⭐ {{ item.rating }}
            </span>
          </div>

        </div>

        <!-- 4. Content / Description -->
        <div class="card-content">
          <p>
            <span class="username" *ngIf="item.type === 'post'">{{ item.user }}</span>
            <span class="username" *ngIf="item.type !== 'post'">{{ item.name }}</span>
            {{ item.desc }}
          </p>
          <div class="comments-link" (click)="handleAction('comment')">Ver los comentarios</div>
        </div>

      </div>

    </div>
  </div>

  <div style="height: 80px;"></div>
</ion-content>