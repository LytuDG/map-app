<ion-header class="ion-no-border custom-header">
  <ion-toolbar color="white">
    <div class="logo-container">
      <div class="map-social-logo">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Abstract Friendly Logo: Connecting Nodes/Smile -->
          <circle cx="16" cy="16" r="14" fill="url(#paint0_linear)" fill-opacity="0.1" />
          <path d="M10 16C10 16 12 21 16 21C20 21 22 16 22 16" stroke="url(#paint1_linear)" stroke-width="3"
            stroke-linecap="round" />
          <circle cx="10" cy="14" r="2.5" fill="#F09433" />
          <circle cx="22" cy="14" r="2.5" fill="#BC1888" />
          <defs>
            <linearGradient id="paint0_linear" x1="2" y1="2" x2="30" y2="30" gradientUnits="userSpaceOnUse">
              <stop stop-color="#F09433" />
              <stop offset="1" stop-color="#BC1888" />
            </linearGradient>
            <linearGradient id="paint1_linear" x1="10" y1="16" x2="22" y2="21" gradientUnits="userSpaceOnUse">
              <stop stop-color="#F09433" />
              <stop offset="1" stop-color="#BC1888" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      <ion-title class="app-logo-text">Spotl</ion-title>
    </div>

    <ion-buttons slot="end">
      <ion-button class="icon-btn" (click)="openNotifications()">
        <ion-icon name="notifications-outline"></ion-icon>
        <div class="badge-dot"></div>
      </ion-button>
      <ion-button class="icon-btn" (click)="goToMessages()">
        <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
        <div class="badge-dot" *ngIf="false"></div>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding-bottom">

  <div class="content-wrapper">
    <!-- Search Bar -->
    <div class="search-section ion-padding-horizontal">
      <ion-searchbar placeholder="Buscar usuarios, lugares, eventos..." [(ngModel)]="searchQuery"
        (ionInput)="onSearch($event)" mode="ios" class="custom-searchbar">
      </ion-searchbar>
    </div>

    <!-- Feed List -->
    <div class="feed-list ion-padding-horizontal ion-padding-top">

      <div *ngFor="let item of feedItems" class="unique-feed-card">

        <!-- 1. Media Area -->
        <div class="card-media-wrapper">
          <img [src]="item.img" class="main-img img-load" loading="lazy" />

          <!-- Badges -->
          <div class="badges-container top-right">
            <div class="badge-pill" *ngIf="item.type === 'event'">{{ item.date }}</div>
            <div class="badge-pill deal" *ngIf="item.type === 'deal'">{{ item.offer }}</div>
          </div>

          <!-- User Avatar in bottom-right corner -->
          <div class="avatar-corner">
            <ion-avatar>
              <img [src]="item.userImg" class="img-load" />
            </ion-avatar>
          </div>
        </div>

        <!-- 2. Content Body -->
        <div class="card-body">

          <div class="header-row">
            <div class="main-info">
              <!-- Name: Handle 'post' (user), 'event' (title), others (name) -->
              <span class="username" (click)="navigateToProfile(item)">
                {{ item.type === 'post' ? item.user : (item.type === 'event' ? item.title : item.name) }}
              </span>
              <!-- Subtitle: Handle 'post'/'event' (location), others (category) -->
              <span class="location-label">
                <ion-icon name="location-sharp"></ion-icon>
                {{ (item.type === 'post' || item.type === 'event') ? item.location : item.category }}
              </span>
            </div>

            <!-- Minimal Actions -->
            <div class="mini-actions">
              <ion-button fill="clear" size="small" class="icon-only no-ripple-border" (click)="toggleLike(item)">
                <ion-icon [name]="item.liked ? 'heart' : 'heart-outline'" [class.liked]="item.liked"></ion-icon>
              </ion-button>
              <ion-button fill="clear" size="small" class="icon-only no-ripple-border"
                (click)="handleAction(item, 'share')">
                <ion-icon name="paper-plane-outline"></ion-icon>
              </ion-button>
            </div>
          </div>

          <div class="description-row">
            <p>{{ item.desc }}</p>
          </div>

          <!-- CTA / Footer -->
          <div class="footer-row" *ngIf="item.type !== 'post'">
            <ion-button expand="block" [fill]="(item.going || item.claimed) ? 'solid' : 'outline'" shape="round"
              size="small" class="action-btn" [color]="(item.going || item.claimed) ? 'success' : 'primary'"
              (click)="handleAction(item)">
              <!-- Dynamic Label Logic -->
              <ng-container *ngIf="item.type === 'event'">
                {{ item.going ? 'Asistiendo' : (item.actionLabel || 'Asistiré') }}
              </ng-container>
              <ng-container *ngIf="item.type === 'deal'">
                {{ item.claimed ? 'Reclamado' : (item.actionLabel || 'Reclamar') }}
              </ng-container>
              <ng-container *ngIf="item.type === 'business'">
                {{ item.actionLabel || 'Más Info' }}
              </ng-container>
            </ion-button>
          </div>

          <div class="footer-row post-footer" *ngIf="item.type === 'post'">
            <span class="likes-text" *ngIf="item.likes">{{ item.likes }} likes</span>
            <span class="comments-text" (click)="handleAction(item, 'comment')">Ver comentarios</span>
          </div>

        </div>

      </div>

    </div>

  </div>

  <div style="height: 80px;"></div>
</ion-content>