<ion-header class="ion-no-border custom-header">
  <ion-toolbar color="white">
    <div class="logo-container">
      <app-logo [size]="32"></app-logo>
      <ion-title class="app-logo-text">Spotl</ion-title>
    </div>

    <ion-buttons slot="end">
      <ion-button class="icon-btn" (click)="openNotifications()">
        <ion-icon name="notifications-outline"></ion-icon>
        <div class="badge-dot"></div>
      </ion-button>
      <ion-button class="icon-btn" (click)="goToMessages()">
        <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
        <div class="badge-dot" *ngIf="false"></div>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding-bottom">

  <div class="content-wrapper">
    <!-- Search Bar -->
    <div class="search-section ion-padding-horizontal">
      <ion-searchbar placeholder="Buscar usuarios, lugares, eventos..." [(ngModel)]="searchQuery"
        (ionInput)="onSearch($event)" mode="ios" class="custom-searchbar">
      </ion-searchbar>
    </div>

    <!-- Feed List -->
    <div class="feed-list ion-padding-horizontal ion-padding-top">

      <div *ngFor="let item of feedItems" class="unique-feed-card">

        <!-- 1. Media Area -->
        <div class="card-media-wrapper">
          <img [src]="item.img" class="main-img img-load" loading="lazy" />

          <!-- Badges -->
          <div class="badges-container top-right">
            <div class="badge-pill" *ngIf="item.type === 'event'">{{ item.date }}</div>
            <div class="badge-pill deal" *ngIf="item.type === 'deal'">{{ item.offer }}</div>
          </div>

          <!-- User Avatar in bottom-right corner -->
          <div class="avatar-corner">
            <ion-avatar>
              <img [src]="item.userImg" class="img-load" />
            </ion-avatar>
          </div>
        </div>

        <!-- 2. Content Body -->
        <div class="card-body">

          <div class="header-row">
            <div class="main-info">
              <!-- Name: Handle 'post' (user), 'event' (title), others (name) -->
              <span class="username" (click)="navigateToProfile(item)">
                {{ item.type === 'post' ? item.user : (item.type === 'event' ? item.title : item.name) }}
              </span>
              <!-- Subtitle: Handle 'post'/'event' (location), others (category) -->
              <span class="location-label">
                <ion-icon name="location-sharp"></ion-icon>
                {{ (item.type === 'post' || item.type === 'event') ? item.location : item.category }}
              </span>
            </div>

            <!-- Minimal Actions -->
            <div class="mini-actions">
              <ion-button fill="clear" size="small" class="icon-only no-ripple-border" (click)="toggleLike(item)">
                <ion-icon [name]="item.liked ? 'heart' : 'heart-outline'" [class.liked]="item.liked"></ion-icon>
              </ion-button>
              <ion-button fill="clear" size="small" class="icon-only no-ripple-border"
                (click)="handleAction(item, 'share')">
                <ion-icon name="paper-plane-outline"></ion-icon>
              </ion-button>
            </div>
          </div>

          <div class="description-row">
            <p>{{ item.desc }}</p>
          </div>

          <!-- CTA / Footer -->
          <div class="footer-row minimalist-action-row" *ngIf="item.type !== 'post'">
            <!-- Business/Event Primary Action -->
            <div class="primary-action" (click)="handleAction(item)">
              <ng-container *ngIf="item.type === 'event'">
                <ion-icon [name]="item.going ? 'checkmark-circle' : 'calendar-outline'"
                  [color]="item.going ? 'success' : 'medium'"></ion-icon>
                <span [class.active]="item.going">{{ item.going ? 'Asistiendo' : 'Asistiré' }}</span>
              </ng-container>

              <ng-container *ngIf="item.type === 'deal'">
                <ion-icon [name]="item.claimed ? 'ticket' : 'ticket-outline'"
                  [color]="item.claimed ? 'success' : 'medium'"></ion-icon>
                <span [class.active]="item.claimed">{{ item.claimed ? 'Reclamado' : 'Reclamar' }}</span>
              </ng-container>

              <ng-container *ngIf="item.type === 'business'">
                <span class="info-link">Ver más</span>
              </ng-container>
            </div>
          </div>

          <div class="footer-row post-footer" *ngIf="item.type === 'post'">
            <span class="likes-text" *ngIf="item.likes">{{ item.likes }} likes</span>
            <span class="comments-text" (click)="handleAction(item, 'comment')">Ver comentarios</span>
          </div>

        </div>

      </div>

    </div>

  </div>

  <div style="height: 80px;"></div>
</ion-content>